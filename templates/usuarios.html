{% extends 'layout.html' %}

{% block body %}
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>Lista de Usuarios</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Inicio</a></li>
            <li class="breadcrumb-item active">Usuarios</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <small>
                <div class="card-tools pull-left">
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal-lg">Nuevo Encargado <i class="fa fa-user-plus"></i></button>
                  <a href="#" class="btn btn-success" onclick="window.location.reload();">Refresh <i class="fa fa-refresh"></i></a>
                </div>
              </small>
            </div>
            <!-- /.card-header -->
            <div class="card-body">
              <table id="example2" class="table table-bordered table-hover">
                <thead>
                <tr>
                  <th>ID</th>
                  <th>NOMBRE(s)</th>
                  <th>APELLIDO(s)</th>
                  <th>CI</th>
                  <th>TELEFONO</th>
                  <th>E-MAIL</th>
                  <th>ACTIVO</th>
                  <th>MODIFICACION</th>
                </tr>
                </thead>
                <tbody>
                  {% for usuario in Usuarios %}
                <tr>
                  <td style="width:20px;">{{ usuario['id_usuario'] }}</td>
                  <td>{{ usuario['nombre'] }}</td>
                  <td>{{ usuario['apellido'] }}</td>
                  <td>{{ usuario['ci'] }}</td>
                  <td>{{ usuario['telefono'] }}</td>
                  <td>{{ usuario['email'] }}</td>
                  <td style="width:10px;">
                    <center><i class="fa fa-check" style="color: blue;"></i><i class="fa fa-remove" style="color: red;"></i></center>
                  </td>
                  <td style="width:170px;">
                    <!-- Botón para abrir el modal de edición de usuario -->
                    <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal-xl-{{ usuario['id_usuario'] }}">Editar <i class="fa fa-edit"></i></button>
                    <a href="#" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modal-confirm-delete" onclick="setDeleteUserId('{{ usuario.id_usuario }}')"><i class="fa fa-trash"></i> Eliminar</a>
                  </td>
                </tr>
                <!-- Modal para editar usuario -->
                <div class="modal fade" id="modal-xl-{{ usuario['id_usuario'] }}">
                  <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h4 class="modal-title">Editar Perfil de {{ usuario['nombre'] }} {{ usuario['apellido'] }}</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form method="POST" enctype="multipart/form-data" action="{{ url_for('edit_user', id=usuario['id_usuario']) }}">
                          <div class="row">
                            <div class="col-md-6">
                              <div class="form-group">
                                <label for="nombre">Nombres</label>
                                <input type="text" class="form-control" name="Nombre" value="{{ usuario['nombre'] }}">
                              </div>
                              <div class="form-group">
                                <label for="apellido">Apellidos</label>
                                <input type="text" class="form-control" name="apellido" value="{{ usuario['apellido'] }}">
                              </div>
                              <div class="form-group">
                                <label for="edad">Edad</label>
                                <input type="number" class="form-control" name="edad" value="{{ usuario['edad'] }}">
                              </div>
                              <div class="form-group">
                                <label for="ci">CI</label>
                                <input type="text" class="form-control" name="cedula" value="{{ usuario['ci'] }}">
                              </div>
                              <div class="form-group">
                                <label for="celular">Num. de Celular</label>
                                <input type="text" class="form-control" name="celular" value="{{ usuario['telefono'] }}">
                              </div>
                            </div>

                            <div class="col-md-6">
                              <div class="form-group">
                                <label for="email">Correo Electrónico</label>
                                <input type="email" class="form-control" name="email" value="{{ usuario['email'] }}">
                              </div>
                              <div class="form-group">
                                <label for="user">Nombre de Usuario</label>
                                <input type="text" class="form-control" name="user" value="{{ usuario['usuario'] }}">
                              </div>
                              <div class="form-group">
                                <label for="password">Contraseña</label>
                                <input type="password" class="form-control" name="password" value="{{ usuario['password'] }}">
                              </div>
                              <div class="form-group">
                                <label for="sexo">Sexo</label>
                                <div>
                                  <label class="radio-inline">
                                    <input type="radio" name="sexo" value="Masculino" {% if usuario['sexo'] == 'Masculino' %}checked{% endif %}> Masculino
                                  </label>
                                  <label class="radio-inline">
                                    <input type="radio" name="sexo" value="Femenino" {% if usuario['sexo'] == 'Femenino' %}checked{% endif %}> Femenino
                                  </label>
                                </div>
                              </div>
                              <div class="form-group">
                                <label for="imagen">Subir nueva imagen</label>
                                <input type="file" class="form-control-file" name="imagen">
                                <input type="hidden" name="imagen_actual" value="{{ usuario['imagen'] }}">
                                {% set imagen_usuario = usuario['imagen'] if usuario['imagen'] else 'default.png' %}
                                <img src="{{ url_for('static', filename='Users_Profile/' + imagen_usuario) }}" class="img-thumbnail mt-2" alt="Imagen actual" style="width: 150px;">
                              </div>
                            </div>
                          </div>

                          <div class="modal-footer justify-content-between">
                            <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar</button>
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </tbody>
            </table>
            </div>
        </div>
      </div>
    </div>

    <!-- Modal para Nuevo usuario  -->
    <div class="modal fade" id="modal-lg">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title"><i class="fa fa-user"></i><b> Registro de un Nuevo Usuario</b></h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form action="{{ url_for('new_user') }}" method="POST" enctype="multipart/form-data" id="new-user-form">
              <div class="row">
                <div class="col-md-6">
                  <!-- Nombre con un máximo de 20 caracteres -->
                  <div class="form-group">
                    <label for="nombre">Nombre(s)</label>
                    <input type="text" class="form-control" name="Nombre" placeholder="Ingresa el nombre" maxlength="20" required>
                  </div>

                  <!-- Apellido con un máximo de 20 caracteres -->
                  <div class="form-group">
                    <label for="apellido">Apellido(s)</label>
                    <input type="text" class="form-control" name="apellido" placeholder="Ingresa el apellido" maxlength="20" required>
                  </div>

                  <!-- Edad -->
                  <div class="form-group">
                    <label for="edad">Edad</label>
                    <input type="number" class="form-control" name="edad" placeholder="Ingresa la edad" required>
                  </div>

                  <!-- CI solo números y máximo de 10 caracteres -->
                  <div class="form-group">
                    <label for="ci">CI</label>
                    <input type="text" class="form-control" name="cedula" placeholder="Ingresa el CI" maxlength="10" pattern="\d*" required>
                  </div>

                  <!-- Número de celular solo números y máximo de 10 caracteres -->
                  <div class="form-group">
                    <label for="celular">Num. de Celular</label>
                    <input type="text" class="form-control" name="celular" placeholder="Ingresa el número de celular" maxlength="10" pattern="\d*" required>
                  </div>
                </div>

                <div class="col-md-6">
                  <!-- Correo electrónico -->
                  <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" class="form-control" name="email" placeholder="Ingresa el correo electrónico" required>
                  </div>

                  <!-- Nombre de usuario -->
                  <div class="form-group">
                    <label for="user">Nombre de Usuario</label>
                    <input type="text" class="form-control" name="user" placeholder="Ingresa el nombre de usuario" required>
                  </div>

                  <!-- Contraseña -->
                  <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" class="form-control" name="password" placeholder="Ingresa la contraseña" required>
                  </div>

                  <!-- Sexo -->
                  <div class="form-group">
                    <label for="sexo">Sexo</label>
                    <div>
                      <label class="radio-inline">
                        <input type="radio" name="sexo" value="Masculino" checked> Masculino
                      </label>
                      <label class="radio-inline">
                        <input type="radio" name="sexo" value="Femenino"> Femenino
                      </label>
                    </div>
                  </div>

                  <!-- Subir imagen -->
                  <div class="form-group">
                    <label for="imagen">Subir imagen</label>
                    <input type="file" class="form-control-file" name="imagen" id="imagen">
                  </div>
                </div>
              </div>

              <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-close"></i> Cerrar</button>
                <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Guardar</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de confirmación de eliminación -->
    <div class="modal fade" id="modal-confirm-delete">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Confirmar Eliminación</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>¿Estás seguro de que deseas eliminar este usuario?</p>
          </div>
          <div class="modal-footer justify-content-between">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
            <!-- Agregar el formulario para que pueda realizar la solicitud POST -->
            <form action="" method="POST" id="confirm-delete-form">
              <button type="submit" id="confirm-delete-btn" class="btn btn-danger">Sí, eliminar</button>
            </form>
          </div>
        </div>
      </div>
    </div>




<script>
  // Función para asignar el ID del usuario que se eliminará
  function setDeleteUserId(id) {
      const form = document.getElementById('confirm-delete-form');
      form.action = `/delete_user/${id}`;
  }

  // Ya no es necesario manejar el botón 'confirm-delete-btn' aquí,
  // El formulario se encargará de realizar la solicitud POST directamente.
</script>
    
  
  
  
{% endblock %}
